<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="author" title="About these documents" href="about.html" /><link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="prev" title="Examples" href="examples.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Under the Hood - Autopilot 2025 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Autopilot 2025 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">Autopilot 2025 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">What is Autopilot?</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Under the Hood</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://therekrab.github.io/autopilot/javadoc">Java API</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/technical.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="under-the-hood">
<h1>Under the Hood<a class="headerlink" href="#under-the-hood" title="Link to this heading">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page describes the algorithm behind Autopilot’s path-following
algorithm. This knowledge is <strong>not</strong> necessary to understand how Autopilot
works from the end user’s perspective and is only provided for those
interested.</p>
</div>
<p>To see a live demo of the paths that Autopilot approaches, check out <a class="reference external" href="https://www.desmos.com/calculator/w7penby7ds">this</a> Desmos graph. The purple dot
represents the robot’s initial position.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>A general understanding of polar curves and calculus (Calc II is probably
suitable for this) is recommended to understand what is about to happen.</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">¶</a></h2>
<p>The first thing that Autopilot does to prepare for the computations that follow
is by transforming the robot’s current position into a position from the
target’s point of view, with entry angle being counted as forwards (+x
direction). This also places the target at the origin. This is important.</p>
<p>After all computations are done with velocity calculations, Autopilot undoes
this transformation to return to a global coordinate frame.</p>
</section>
<section id="step-1-the-curve">
<h2>Step 1: The curve<a class="headerlink" href="#step-1-the-curve" title="Link to this heading">¶</a></h2>
<p>Consider the curve <span class="math notranslate nohighlight">\(r=a\theta^b\)</span>. By playing with the parameter
<span class="math notranslate nohighlight">\(a\)</span>, the curve is scaled. By changing <span class="math notranslate nohighlight">\(b\)</span>, the shape of the curve
itself is different.</p>
<p>This curve has a variety of useful applications:</p>
<ol class="arabic simple">
<li><p>For all <span class="math notranslate nohighlight">\(b \gt 0\)</span>, <span class="math notranslate nohighlight">\(r\)</span> equals 0 when <span class="math notranslate nohighlight">\(\theta\)</span> is zero.
This means that following the curve inwards always reaches the origin (which
is where the target is in a target coordinate frame). Reaching the target is
good.</p></li>
<li><p>Modifying <span class="math notranslate nohighlight">\(a\)</span> only scales the curve. This means that if some point is
placed on the cartesian plane and this curve is overlaid, scaling the curve
by changing <span class="math notranslate nohighlight">\(a\)</span> can cause the curve to touch a. Generating a path that
includes the current position is good.</p></li>
<li><p>The curve is always decreasing for smaller values of <span class="math notranslate nohighlight">\(\theta\)</span>. As
<span class="math notranslate nohighlight">\(\theta\)</span> approaches zero, the curve moves towards the center. Because
<span class="math notranslate nohighlight">\(\theta = 0\)</span> is aligned with the positive x axis, entry angle is
always respected, which is good.</p></li>
</ol>
<p>The value for <span class="math notranslate nohighlight">\(a\)</span> must scale dynamically, but the value of <span class="math notranslate nohighlight">\(b\)</span> is
left unrestricted. Autopilot chooses <span class="math notranslate nohighlight">\(b\)</span> to be 1. There are two reasons for this:</p>
<ol class="loweralpha simple">
<li><p>The curve is generally smooth. The “eyeball test” determines that the curve
looks generally good enough to be followed, even at high speeds. There are
no “sharp” corners.</p></li>
<li><p>The arc length of the curve is easily found. Curves with <span class="math notranslate nohighlight">\(b \ne 1\)</span> are
much more difficult to solve for arc length. This is <em>very</em> important later.</p></li>
</ol>
</section>
<section id="step-2-scaling-the-curve">
<h2>Step 2: Scaling the curve<a class="headerlink" href="#step-2-scaling-the-curve" title="Link to this heading">¶</a></h2>
<p>To determine the correct curve to use, the offset must be touching the curve.
Otherwise, the curve doesn’t seem reasonable. To scale the curve, we must
convert the current position into polar coordinates. We will refer to the angle
part of the polar coordinate as <span class="math notranslate nohighlight">\(\theta_1\)</span> and the radius will be
<span class="math notranslate nohighlight">\(S\)</span>. Note that <span class="math notranslate nohighlight">\(S\)</span> is the distance from the target to the current
position, or vice versa (it’s the magnitude of displacement).</p>
<p>Once the current position is in polar coordinates, multiplying the curve
<span class="math notranslate nohighlight">\(r = \theta\)</span> by the scale factor of <span class="math notranslate nohighlight">\(S \over \theta_1\)</span>. This works
because when <span class="math notranslate nohighlight">\(\theta = \theta_1\)</span>, the fraction <span class="math notranslate nohighlight">\(\theta \over \theta_1\)</span>
cancels out and becomes 1, leaving <span class="math notranslate nohighlight">\(S\)</span> - the correct radius for the curve at
that point.</p>
<p>Now the final equation for the curve is as follows:</p>
<p><span class="math notranslate nohighlight">\(r = {{ S \cdot \theta } \over \theta_1}\)</span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This equation is <strong>never</strong> found in the code for Autopilot. This is just an
explanation of <em>what</em> the curve is, and how it was developed.</p>
</div>
</section>
<section id="step-3-finding-direction">
<h2>Step 3: Finding direction<a class="headerlink" href="#step-3-finding-direction" title="Link to this heading">¶</a></h2>
<p>Autopilot doesn’t care what the curve is. During one call to <code class="docutils literal notranslate"><span class="pre">calculate()</span></code>,
the only part of the curve that matters right now is the direction that the
robot has to go in to follow the curve - the curve itself doesn’t matter.</p>
<p>To find the direction (in cartesian X/Y coordinates for velocity) of the curve, the curve needs
to be converted to rectangular form with the following formulae:</p>
<p><span class="math notranslate nohighlight">\(x = r \cdot cos(\theta)\)</span></p>
<p><span class="math notranslate nohighlight">\(y = r \cdot sin(\theta)\)</span></p>
<p>Differentiating each term with respect to theta:</p>
<p><span class="math notranslate nohighlight">\({dx \over d\theta} = r \cdot -sin(\theta) + {dr \over d\theta} \cdot cos(\theta)\)</span></p>
<p><span class="math notranslate nohighlight">\({dy \over d\theta} = r \cdot cos(\theta) + {dr \over d\theta} \cdot sin(\theta)\)</span></p>
<p>To solve for <span class="math notranslate nohighlight">\(dr \over d\theta\)</span>, we differentiate <span class="math notranslate nohighlight">\(r = {S \cdot
\theta \over \theta_1}\)</span> to get <span class="math notranslate nohighlight">\({dr \over d\theta} = {S \over \theta_1}\)</span>.</p>
<p>Notice that <span class="math notranslate nohighlight">\(r = {S \cdot \theta \over \theta_1}\)</span> can be rewritten as
<span class="math notranslate nohighlight">\(r = {dr \over d\theta} \cdot \theta\)</span>. This means that we can pull the
term <span class="math notranslate nohighlight">\({dr \over d\theta}\)</span> out of the expressions for both <span class="math notranslate nohighlight">\(dx \over
d\theta\)</span> and <span class="math notranslate nohighlight">\(dy \over d\theta\)</span>:</p>
<p><span class="math notranslate nohighlight">\({dx \over d\theta} = {dr \over d\theta} \cdot [\theta \cdot -sin(\theta) + cos(\theta)]\)</span></p>
<p><span class="math notranslate nohighlight">\({dy \over d\theta} = {dr \over d\theta} \cdot [\theta \cdot cos(\theta) + sin(\theta)]\)</span></p>
<p>Because we want to find the direction of the curve at this point, we create the
following vector:</p>
<p><span class="math notranslate nohighlight">\([{dx \over d\theta}, {dy \over d\theta}]\)</span></p>
<p>But we only want direction, so we should normalize this vector to become a unit
vector (a vector with magnitude 1). This means that any constant that the
vector is multiplied by is “cancelled out”. Because each component of the
vector is scaled by <span class="math notranslate nohighlight">\(S \over \theta_1\)</span>, the entire vector is scaled by
<span class="math notranslate nohighlight">\(S \over \theta_1\)</span>. But normalizing a vector ignores any scaling done, so
when we compute the actual velocity, we don’t need to compute <span class="math notranslate nohighlight">\(S \over
\theta_1\)</span> and can leave that part out.</p>
</section>
<section id="step-4-calculate-speed">
<h2>Step 4: Calculate Speed<a class="headerlink" href="#step-4-calculate-speed" title="Link to this heading">¶</a></h2>
<p>This section is divided into two parts, because it is quite long.</p>
<section id="pt-i">
<h3>Pt. I<a class="headerlink" href="#pt-i" title="Link to this heading">¶</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>This is a <strong>long</strong> section. Be prepared for lots of formulae and
expressions.</p>
</div>
<p>Once we have a unit vector telling us in what direction we need to drive the
robot, it becomes important to know <em>how fast</em> we should go in that direction.</p>
<p>Because swerve drive uses an independent motor for drive and steer, it stands
to reason that changes in the direction of a path do not affect the robot’s
speed. The only thing that affects the speed of the robot is the drive motors,
and the only thing that changing direction affects is the steer motors.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this example, rotating is ignored. When the robot rotates, not all of the
drive motors are going in the same direction, which is what creates the
rotation in the chassis, so speed is limited.</p>
</div>
<p>The conclusion here is that we really only care about the distance that we
travel, so <strong>we can express speed as a function of distance</strong>.</p>
<p>The approach that Autopilot takes is as follows:</p>
<ol class="arabic simple">
<li><p>Calculate max theoretical velocity. This value is “theoretical” because it
doesn’t take into account the robot’s current velocities. This value is also
the maximum value that obeys the motion constraints, i.e. “max”.</p></li>
<li><p>Adjust that velocity from the current velocity to obey acceleration limits (somewhat).</p></li>
</ol>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you’re not already familiar with the three phases of an
Autopilot flight, please read <a class="reference internal" href="about.html"><span class="doc">What is Autopilot?</span></a></p>
</div>
<p>The actual implementation of this differs significantly from the implementation
used in WPILib’s <code class="docutils literal notranslate"><span class="pre">ProfiledPIDController</span></code>, which uses time to calculate the
current phase. Autopilot makes an effort to leave time out of the equation,
because it can often introduce far too much complexity when it doesn’t need to.</p>
<p>The approach that Autopilot uses to calculate the theoretical max involves
<em>only</em> computing the ideal velocity as if the robot was in the landing phase.
Recall that the landing phase uses constant jerk. The first step in solving for
velocity with respect to distance is solving for velocity with respect to time,
<span class="math notranslate nohighlight">\(v(t)\)</span>.</p>
<p>Now is probably a good time to take a moment and explain how we are going to
solve for <span class="math notranslate nohighlight">\(v(x)\)</span>. If we integrate <span class="math notranslate nohighlight">\(v(t)\)</span> to get <span class="math notranslate nohighlight">\(x(t)\)</span>, and
then find its inverse, <span class="math notranslate nohighlight">\(t(x)\)</span>, we can then plug in the result of
<span class="math notranslate nohighlight">\(t(x)\)</span> into the velocity function to get the equation for the velocity
given some distance.</p>
<p>But the first step is finding <span class="math notranslate nohighlight">\(v(t)\)</span>.</p>
<p>If you don’t already know the physics equations for this, we will derive them
now using a Taylor series. But this isn’t a very tricky Taylor series. In fact,
this is probably one of the easiest Taylor series computations ever. Here’s why:</p>
<p>Firstly, the series is centered at <span class="math notranslate nohighlight">\(t = 0\)</span>, and we know that at that
point, the robot’s velocity should be 0. Because we also want zero acceleration
at the end of the path, we also can say that acceleration should be zero.
Finally, we know that we use constant jerk, so jerk is some constant <span class="math notranslate nohighlight">\(j\)</span>.
Because jerk is constant with respect to time, we know that all derivates of
jerk are 0. Here’s a table showing what we know:</p>
<div class="table-wrapper docutils container" id="id1">
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Derivates of Velocity</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p><span class="math notranslate nohighlight">\(n\)</span></p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(v^{(n)}(t)\)</span></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(1\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(j\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(&gt;2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(0\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Setting up a Taylor series here becomes trivial, because most terms are
multiplied by <span class="math notranslate nohighlight">\(0\)</span>:</p>
<p><span class="math notranslate nohighlight">\(v(t) = 0 + 0 + {1 \over 2} jt^2 + 0 + ...\)</span></p>
<p><span class="math notranslate nohighlight">\(v(t) = {1 \over 2} jt^2\)</span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If <span class="math notranslate nohighlight">\(t=0\)</span> represents the <em>end</em> of the path, does that mean that
we’re going to be expecting negative values for <span class="math notranslate nohighlight">\(t\)</span>? I’ve decided that
for simplicity, we’ll actually say that <span class="math notranslate nohighlight">\(t\)</span> actually represents the
amount of time <em>until</em> landing. This doesn’t mess with our equations, which
is good.</p>
</div>
<p>Now we have to integrate this to solve for <span class="math notranslate nohighlight">\(x(t)\)</span>, but this is pretty
simple:</p>
<p><span class="math notranslate nohighlight">\(\int{1 \over 2} jt^2 dt = {1 \over 3} \cdot {1 \over 2} jt^3 + C = {1 \over 6} jt^3 + C\)</span></p>
<p>But now we have to define what the value of <span class="math notranslate nohighlight">\(x(0)\)</span> should be (therefore
solving for <span class="math notranslate nohighlight">\(C\)</span>). Using our target coordinate frame, we know that at
<span class="math notranslate nohighlight">\(t=0\)</span>, our position in this coordinate frame should also be zero.
Therefore, <span class="math notranslate nohighlight">\(C = 0\)</span>, leaving us with:</p>
<p><span class="math notranslate nohighlight">\(x(t) = {1 \over 6} jt^3\)</span></p>
<p>We can now attempt to solve for this function’s inverse, and we will get:</p>
<p><span class="math notranslate nohighlight">\({6x \over j} = t^3\)</span></p>
<p><span class="math notranslate nohighlight">\(t = ({6x \over j})^{1 \over 3}\)</span></p>
<p>There we go! We’ve only got one step left: we plug in the expression for
<span class="math notranslate nohighlight">\(t\)</span> we got here into our original equation for <span class="math notranslate nohighlight">\(v(t)\)</span> to get a
function that tells us velocity as a function of distance, not time.</p>
<p><span class="math notranslate nohighlight">\(v(t) = v(({6x \over j})^{1 \over 3})\)</span></p>
<p><span class="math notranslate nohighlight">\(= {1 \over 2} j [({6x \over j})^{1 \over 3}]^{2}\)</span></p>
<p><span class="math notranslate nohighlight">\(= {1 \over 2} j ({6x \over j})^{2 \over 3}\)</span></p>
<p><span class="math notranslate nohighlight">\(= {1 \over 2} (36jx^2)^{1 \over 3}\)</span></p>
<p><span class="math notranslate nohighlight">\(= ({36 \over 8} j x^2)^{1 \over 3}\)</span></p>
<p>Simplifying gives us the final equation:</p>
<p><span class="math notranslate nohighlight">\(v(x) = ({9 \over 2} j x^2)^{1 \over 3}\)</span></p>
<p>This is <strong>exactly</strong> what we needed! This gives us the maximum velocity at some
distance to still be within the jerk constraint. But there’s one more step to
be done: we still need to compensate for current speeds.</p>
<p>If the robot is at rest, we don’t want to instantly command the max velocity.
We need to approach the goal velocity, which is where the acceleration
constraint comes into play.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>For the rest of this section, I use “velocity” when I refer to
“velocity in the goal direction of motion”. These definitely are <em>not</em> the
same thing, so it’s important to note.</p>
</div>
<p>If we know the change in time among calls to Autopilot (robot periodic is 20
milliseconds), we can compute the maximum change in velocity that is acceptable
during this time by multiplying <span class="math notranslate nohighlight">\(\Delta t\)</span> by our acceleration value.</p>
<p>This is the largest legal change in robot velocity if we always obey our
constraints. If the difference between the ideal velocity and the current velocity
is smaller than that change, then we can simply apply the ideal velocity.</p>
<p>Finally, the commanded velocity is capped at whatever the velocity constraint
is, if it exists.</p>
<p>Before I wrap up this section, it’s important to note the times when Autopilot
doesn’t obey its given constraints.</p>
<p>Firstly, if the current velocity is higher than the theoretical velocity, the
theoretical velocity is always applied, even if the change is greater than the
calculated max change. This is not a bug; this is a design choice. In a path,
smoothness is especially important <em>at the end</em> of the path. Because Autopilot
never demands a velocity higher than the ideal velocity, it is reasonable to
say that anytime when velocity is significantly higher than theoretical is due
to initial conditions. Rather than do its best while obeying constraints and
arrive at the target too fast (for end velocity of zero, nonzero end velocity
is bad), Autopilot will instead violate its constraints at the start as to
prevent issues later. In this situation, the tradeoff lies between jerky motion
at a point where that isn’t critical to the final motion, or surprising the
user with unexpected behavior.</p>
<p>The second instance where Autopilot doesn’t follow its own constraints is with
regards to motion that is not in the direction of the path. This motion can be
due to bad initial conditions, or - and more importantly - it can be due to a
discrete time step controller rather than a continuous motion. Autopilot doesn’t
technically always follow its own path, but this is because from one cycle to
another, the robot should be travelling in a straight line - but this doesn’t
follow with the path; therefore there will be a little error. Autopilot never
tells the robot to move in a different direction from the correct direction to
follow the path. Although this can very much risk sudden changes in velocity,
that is normally due to poor initial conditions for the path. Autopilot <em>could</em>
implement a different acceleration constraint to correct for velocity error,
but this adds another step that needs to be tuned. And what’s worse is that for
the reasons mentioned above, this sort of correction is important and
improperly tuning it could cause Autopilot to tell the robot to oscillate or
exhibit weird behavior. This was another design decision - we want to make any
jerky motions at the start of an Autopilot action.</p>
</section>
<section id="pt-ii">
<h3>Pt. II<a class="headerlink" href="#pt-ii" title="Link to this heading">¶</a></h3>
<p>We cannot assume that distance that we will need to travel is equal to the
magnitude of the displacement from the target (<span class="math notranslate nohighlight">\(S\)</span> from earlier).</p>
<p>Notice that the length of the path that we have to travel is the length of the
curve from 0 to the current angle. This is called <strong>arc length</strong>, and we have
an integral expression to calculate it:</p>
<p><span class="math notranslate nohighlight">\(L = \int_0^{|\theta_1|}\sqrt{[r(\theta)]^2 + ({dr \over d\theta})^2}d\theta\)</span></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We take the absolute value of our angle because if we have an angle that’s
negative, we still want a positive length.</p>
</div>
<p>We already solved for <span class="math notranslate nohighlight">\({dr \over d\theta}\)</span> earlier when computing the
direction of velocity, so let’s use it’s value: <span class="math notranslate nohighlight">\(S \over \theta_1\)</span>.</p>
<p>We substitute this expression in as well as the expression for
<span class="math notranslate nohighlight">\(r(\theta)\)</span> and get:</p>
<p><span class="math notranslate nohighlight">\(L = \int_0^{|\theta_1|}\sqrt{({S \theta \over \theta_1})^2 + ({S \over
\theta_1})^2}d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= \int_0^{|\theta_1|}({S \over \theta_1})\sqrt{\theta^2 + 1}d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= ({S \over \theta_1})\int_0^{|\theta_1|}\sqrt{\theta^2 + 1}d\theta\)</span></p>
<p>Next, a few things are going to happen: Firstly, we’re going to forget (for
now) about the constant multiplier outside the integral. We’ll return to it
later, but it’s a trivial multiplication and not at all interesting. Secondly,
I’m going to replace all instances of <span class="math notranslate nohighlight">\(\theta\)</span> with <span class="math notranslate nohighlight">\(x\)</span>. Finally,
I’m going to also omit the bounds of integration. Again, they’ll return later,
but they’re not the special part here.</p>
<p>Now our integral to solve has become:</p>
<p><span class="math notranslate nohighlight">\(\int \sqrt {x^2 + 1}dx\)</span></p>
<p>This integral is a fun nightmare to work out by hand, so feel free to skip if
it gets boring. You’ve been warned.</p>
<p>We can begin with a trig substitution:</p>
<p><span class="math notranslate nohighlight">\(\text{let } x = \tan(\theta)\)</span></p>
<p><span class="math notranslate nohighlight">\({dx \over d\theta} = \sec^2(\theta)\)</span></p>
<p><span class="math notranslate nohighlight">\(dx = \sec^2(\theta)d\theta\)</span></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Please</strong> remember that this <span class="math notranslate nohighlight">\(\theta\)</span> is <strong>NOT</strong> the same
<span class="math notranslate nohighlight">\(\theta\)</span> as before.</p>
</div>
<p>After this substitution, our integral becomes:</p>
<p><span class="math notranslate nohighlight">\(\int \sqrt{\tan^2(\theta) + 1} \cdot \sec^2(\theta)d\theta\)</span></p>
<p>Recalling that <span class="math notranslate nohighlight">\(\tan^2(a) + 1 = \sec^2(a)\)</span>:</p>
<p><span class="math notranslate nohighlight">\(\int \sqrt{\sec^2(\theta)} \cdot \sec^2(\theta)d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= \int \sec(\theta) \cdot \sec^2(\theta)d\theta\)</span></p>
<p>Now, we can use integration by parts to “simplify” this expression:</p>
<div class="table-wrapper colwidths-given docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(u = \sec(\theta)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(v = \tan(\theta)\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(u' = \sec(\theta)\tan(\theta)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(v' = \sec^2(\theta)\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>Thus, the integral becomes:</p>
<p><span class="math notranslate nohighlight">\(\sec(\theta)\tan(\theta) - \int \sec(\theta)\tan^2(\theta)d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= \sec(\theta)\tan(\theta) - \int \sec(\theta)[\sec^2(\theta) - 1]d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= \sec(\theta)\tan(\theta) - \int [\sec^3(\theta) - \sec(\theta)]d\theta\)</span></p>
<p><span class="math notranslate nohighlight">\(= \sec(\theta)\tan(\theta) - \int \sec^3(\theta)d\theta + \int \sec(\theta)d\theta\)</span></p>
<p>The integration of <span class="math notranslate nohighlight">\(\sec(\theta)\)</span> is given to be <span class="math notranslate nohighlight">\(\ln |\sec(\theta) +
\tan(\theta)| + C\)</span>. A proof of this is left to the reader.</p>
<p>Our integral transforms into:</p>
<p><span class="math notranslate nohighlight">\(\int \sec^3(\theta)d\theta = \sec(\theta)\tan(\theta) + \ln |\sec(\theta) +
\tan(\theta)| - \int \sec^3(\theta)d\theta\)</span></p>
<p>Moving the integral term to the left side:</p>
<p><span class="math notranslate nohighlight">\(2\int \sec^3(\theta)d\theta = \sec(\theta)\tan(\theta) + \ln |\sec(\theta) + \tan(\theta)|\)</span></p>
<p>Dividing each side by 2 solves the integral:</p>
<p><span class="math notranslate nohighlight">\(\int \sec^3(\theta)d\theta = {1 \over 2}[\sec(\theta)\tan(\theta) + \ln
|\sec(\theta) + \tan(\theta)|]\)</span></p>
<p>But we’re not done yet. We still need to move back into the <span class="math notranslate nohighlight">\(x\)</span> world.</p>
<p>But this is what we know:</p>
<div class="table-wrapper docutils container">
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(\tan(\theta)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(x\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(\sec(\theta)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\sqrt{1 + x^2}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<p>We can substitute these values into the expression for the integral and get:</p>
<p><span class="math notranslate nohighlight">\({1 \over 2}[x \sqrt{1+x^2} + \ln |x + \sqrt{1+x^2}|]\)</span></p>
<p>Note that plugging <span class="math notranslate nohighlight">\(x = 0\)</span> into this expression results in a value of
<cite>0</cite>. When we evaluate the integral from 0 to <span class="math notranslate nohighlight">\(|\theta_1|\)</span>, we only need to
compute the value of this expression when we plug in <span class="math notranslate nohighlight">\(x = |\theta_1|\)</span>.</p>
<p>But we’re not quite done yet. We still need to remember that constant that we
multiplied the integral by: <span class="math notranslate nohighlight">\(S \over \theta_1\)</span>.</p>
<p>Here’s what happens when we plug that in:</p>
<p><span class="math notranslate nohighlight">\({S \over 2\theta_1}[x \sqrt{1+x^2} + \ln |x + \sqrt{1+x^2}|]\)</span></p>
<p><span class="math notranslate nohighlight">\(= {S \over 2\theta_1}x\sqrt{1+x^2} + {S \over 2\theta_1}\ln |x + \sqrt{1+x^2}|\)</span></p>
<p>In the first term, something happens when we let <span class="math notranslate nohighlight">\(x=\theta_1\)</span>. The fraction
<span class="math notranslate nohighlight">\(\theta_1 \over \theta_1\)</span> reduces to just 1:</p>
<p><span class="math notranslate nohighlight">\(L = {S \over 2}\sqrt{1+\theta_1^2} + {S \over 2\theta_1}\ln |\theta_1 +
\sqrt{1+\theta_1^2}|\)</span></p>
<p>This is the final formula that is found in the code for Autopilot, with one
exception: if <span class="math notranslate nohighlight">\(theta_1 = 0\)</span>, the result is just <span class="math notranslate nohighlight">\(S\)</span>. The reason for
this edge case is because if the angle is 0, the robot should only drive
straight in (and dividing by 0… computers don’t like that).</p>
<p>This gives us a formula for the distance along the path that we have left to
travel. If we plug this into the formula for velocity given distance that we
found in pt. I, we are given a scalar by which we can multiply the vector we
got from Step 3, finally giving us a vector that represents the robot’s
velocity.</p>
</section>
</section>
<section id="step-5-wrapping-it-up">
<h2>Step 5: Wrapping it up<a class="headerlink" href="#step-5-wrapping-it-up" title="Link to this heading">¶</a></h2>
<p>At this point, the necessary calculations are in place; we know the correct
direction to drive in, and the correct speed to demand in that direction.</p>
<p>Finally, Autopilot returns this value to a global coordinate frame (remember,
this was all taking place in a target-centric coordinate frame?) and returns it
to the user.</p>
<section id="rotation">
<h3>Rotation<a class="headerlink" href="#rotation" title="Link to this heading">¶</a></h3>
<p>Any rotation logic is much simpler, and does not merit its own section. This is
primarily due to the fact that Autopilot only returns a rotation setpoint, not
a rotational rate. Nevertheless, I will explain how Autopilot decides what
direction to request.</p>
<p>The first check Autopilot makes is whether the current target has a rotation
radius. If it doesn’t, then there are no restraints on whether the target’s
rotation is demanded. Therefore, the target’s rotation is demanded.</p>
<p>If a rotation radius is in place, then Autopilot looks at the current distance
to the target. Is it smaller than the rotation radius? If so, then the target’s
rotation is demanded. Otherwise, Autopilot simply returns the original rotation.</p>
</section>
<section id="a-quick-note-about-entry-angle">
<h3>A quick note about entry angle<a class="headerlink" href="#a-quick-note-about-entry-angle" title="Link to this heading">¶</a></h3>
<p>The most pedantic readers will notice one discrepancy between how entry angle
is described here and its behavior in code. This difference can be explained with
the following image of an Autopilot trajectory:</p>
<a class="reference internal image-reference" href="_images/entry-angle.png"><img alt="_images/entry-angle.png" src="_images/entry-angle.png" style="width: 400px;" />
</a>
<p>This graph is viewed from the target’s coordinate frame, so the positive X axis
represents the direction the robot should come from. However, consider the case
when entry angle is zero. Then, this image looks exactly like the
field-relative view of this motion.</p>
<p>The technicallity here versus what is observed in practice with Autopilot is
the fact that here, the robot should approach from the positive X direction,
but in the real world, the robot approaches from the opposite direction. This
is not a bug. This is done to make it easier to imagine the correct entry angle
when writing code with Autopilot. Imagine an angle of 0. Does the angle point
to the left or to the right? Most will say that the angle starts at the origin
and points right. But an entry angle of zero, as shown in the image, actually
would cause the robot to approach <em>from</em> the right, i.e. would end going to the
left. This inverts the behavior that seems reasonable. Therefore, Autopilot
quietly flips the given entry angle so that it is the angle that the robot ends
travelling in.</p>
<p>This seems like the “least surprising” meaning of entry angle. Consider the
entry angle as if it was drawn as a vector pointing in that direction. The
arrow (if you picture it that way) that the vector points is the way that the
robot approaches from. It seems to be the more intuitive design.</p>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="examples.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Examples</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Nolan Barker
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Under the Hood</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#step-1-the-curve">Step 1: The curve</a></li>
<li><a class="reference internal" href="#step-2-scaling-the-curve">Step 2: Scaling the curve</a></li>
<li><a class="reference internal" href="#step-3-finding-direction">Step 3: Finding direction</a></li>
<li><a class="reference internal" href="#step-4-calculate-speed">Step 4: Calculate Speed</a><ul>
<li><a class="reference internal" href="#pt-i">Pt. I</a></li>
<li><a class="reference internal" href="#pt-ii">Pt. II</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step-5-wrapping-it-up">Step 5: Wrapping it up</a><ul>
<li><a class="reference internal" href="#rotation">Rotation</a></li>
<li><a class="reference internal" href="#a-quick-note-about-entry-angle">A quick note about entry angle</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=cb975c41"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>